
	@(#) README V3.1 (C) 2010-2023 by Roman Oreshnikov

	Пакет скриптов и служебных файлов для автоматизации
управления DNS записями и учета подключений объектов ИТС

	1. Назначение

а) ведение объектов ИТС;
б) учёт соединений объектов ИТС;
в) ведение DNS зон;
г) закрепления IP адресов за объектами ИТС;
д) автоматизация обновления записей на DNS сервере.

	2. Состав

README	 - этот файл
Makefile - сценарий действий
Rchk	 - скрипт автоматизации тестирования
Rdns	 - скрипт автоматизации ведения объектов ИТС и DNS зон
Rdns.cgi - скрипт визуализации таблицы объектов ИТС
Rdns.tst - сценарий автотестирования Rdns

	3. Установка и настройка

а) скопируйте файлы дистрибутива в рабочий каталог;
б) скопируте CGI-скрипт в соответствующий каталог вашего WWW-сервера;
в) создайте файлы описания DNS зон и объектов сетевой инфраструктуры;
г) измените Makefile в соответствии со своими предпочтениями;
д) проверьте, что таблица Rdns.htm доступна в корне вашего WWW-сервера.

	4. Описание DNS зон и объектов ИТС

	Описание представляет собой один или несколько текстовых файлов, где
каждая строка должна быть предопределенного ниже формата и важен их порядок.

а) Обозначения:

<class>	- класс DNS имен (только IN)
<inv>	- инвентарный №
<ip>	- IPv4 адрес
<ip-pi>	- IPv4 адрес в реверсной нотации
<line>	- маркировка розетки СКС или соединительного кабеля
	зарезервированные значения:
	?	; не подключено
	-	; не предусмотрено
<mac>	- MAC-адрес, в форматах XX:XX:XX:XX:XX:XX или XXXX.XXXX.XXXX
<name>	- доменное имя
<num>	- счетчик
<note>	- комментарий
<opt>	- формализованный параметр
<link>	- ссылка на объект, если начинается с /, то это порт этого же объекта
<port>	- порт объекта сетевой инфраструктуры
<rdata>	- соответствующие для <type> данные
<ser>	- серийный (заводской) №
<ttl>	- время жизни записи в секундах, 5m <= ttl <= 7d {1d}
<type>	- тип RR записи DNS, один из:
	A	; Internet Address (IPv4)
	AAAA	; Internet Address (IPv6)
	CNAME	; Canonical Name /nickname pointer/
	MX	; Mail Exchanger
	NS	; Name Server
	PTR	; Pointer
	SOA	; Start Of Authority
	SRV	; Service
	TXT	; Text
<zone>	- доменное имя или IPv4 адрес сети с бит-маской

б) Форматы строк:

1. Комментарии:
от начальных пробелов в строке и символа '#' или ';' до конца строки
в середине строки, от пробельного символа и ';' до конца строки

2. Текущий домен DNS:
$ORIGIN <name>

3. Текущий TTL для DNS записей:
$TTL <ttl>

4. Объявление DNS зоны и её NS серверов - владельцев:
.Zone <zone> [<name> …]
	- Первый из указанных NS является владельцем зоны, при этом,
	конфигурация DNS строится для NS первой зарегистрированной зоны.
	Если список пуст или в нём отсутствует вышеуказанный NS, то это
	необслуживаемая зона

5. Стандартная RR запись DNS:
<name> [<ttl>] [<class>] <type> <rdata>
	- Обрабатываются только A, CNAME, MX и PTR

6. Регистрация DNS домена в прямой и обратной зонах:
<name> <ip> [<num>|<ip> …]
	- Для всех <ip> генерятся прямые DNS записи: <name> <ttl> IN A <ip>
	и реверсные DNS записи: <ip-pi>.in-addr.arpa. <ttl> IN PTR <name>
	- Если указан <num>, то производится автогенерация дополнительно <num>
	записей, где <name> используется как шаблон для новых доменных имен
	(последние цифры <name> задают начальное значение, а их количество -
	формат замещения)

7. Описание объекта инфраструктуры:
<name>[/<port>] [<line>] [<mac>] [<opt> …] [$<ser>] [#<inv>] [@link] [/<note>]

8. Кроссовое соединение:
.Join <line> <line>

	Привязка DNS записей осуществляется к объекту с таким же именем без
именованного порта. Для привязки DNS записей к именованному порту объекта
следует использовать ссылочный объект. Примеры приведены ниже.

	5. Использование

	Предполагается три режима использования:

а) управление DNS зонами;
б) ведение таблицы объектов инфраструктуры, их инвентарных номеров, соединений
и закрепления IP адресов за ними;
в) предыдущие режимы совместно.

	Построение таблицы объектов и управление DNS осуществляется с помощью
прилагаемого сценария Makefile:

a) Получение справки о возможных целях:
$ make help

б) Выполнить автотест, в протоколе которого отражены типичные операции:
$ make test

в) Создать таблицу подключений, список используемых DNS записей и,
при необходимости, выполнить запрос на обновление для NS сервера: 
$ make

	6. Приложение

а) Зарезервированная DNS запись:
;localhost IN A 127.0.0.1

б) Зарезервированные зоны:
;.Zone	.		; Корневая зона
;.Zone	arpa.		; Реверсная зона
;.Zone	localhost.	; RFC 1912
;.Zone	0/8		; "This" Network (RFCs 1912 and 3330)
;.Zone	127/8		; RFC 1912
;.Zone	169.254/16	; Link-local/APIPA (RFCs 3330 and 3927)
;.Zone	192.0.2/24	; TEST-NET for Documentation (RFC 3330)
;.Zone	198.18/15	; Router Benchmark Testing (RFC 3330)
;.Zone	240/4		; IANA Reserved - Old Class E Space

в) IP зоны для локального использования:
.Zone	10/8		; Private Use Networks (RFC 1918)
.Zone	172.16/12	; Private Use Networks (RFC 1918)
.Zone	192.168/16	; Private Use Networks (RFC 1918)

г) Пример конфигурации:
#
#	Описание объектов
#
arm    L1 12:34:56:78:90:12 #11111       ;ПЭВМ
laptop L2 ab:cd:ef:01:23:45 #01234 @boss ;Ноутбук, DNS имя - boss
mfu    L3 a1:b2:e3:c4:d5:e6 #543         ;Принтер
#
server1      E-srv1   01:23:34:56:78:90 #1234 ;Порт управления
server1/G1   E-srv/1 01:23:34:56:78:91 @ns   ;1-й интерфейс данных
server1/G2   E-srv/2 01:23:34:56:78:92 @noc  ;2-й интерфейс данных
#
server2      E-srv2  02:34:56:78:90:12 #234
server2/Bond - @fs ;Объединенный интерфейс LACP группы из G1 и G2
server2/G1   E-srv2/1  @/Bond
server2/G2   E-srv2/2  @/Bond
#
dc	E-srv3
server3 E-srv4	@node1 @Cluster
server4 E-srv5	@node2 @cluster
#
router/G1    ToProvider aa:bb:cc:dd:ee:ff	@my ;Выход в сеть провайдера
router/G2    E-gw	aa:bb:cc:dd:ee:ff	@gw
#
switch/G01 E-srv1
switch/G02 E-srv1/1	Vlan2
switch/G03 E-srv1/2
switch/G04 E-srv2
switch/G05 E-srv2/1	Vlan2 @/Po1
switch/G06 E-srv2/2	Vlan2 @/Po1
switch/G07 L2		Vlan2
switch/G08 L3		Vlan2
switch/G09 L1		Vlan2
switch/G10 E-gw		Vlan2
switch/G11 E-srv3	Vlan2
switch/G12 E-srv4	Vlan2
switch/G13 E-srv5	Vlan2
switch/G14 ?		disable
switch/Vlan1 - @switch ;Интерфейс управления коммутатора
#
#	Описание DNS
#
$ORIGIN my.domain.
.Zone @    ns
.Zone 10/8 ns
#
.Zone provider. ns.provider.
.Zone 1.2/16 ns.provider.
#
my.domain.provider. 1.2.3.4
#
# Vlan1: Управление ИТС
#
server1	10.0.1.1
server2	10.0.1.2
switch	10.0.1.3
noc	10.0.1.4
#
# Vlan2: Пользовательский сегмент
#
@ A 	10.0.2.22	;Домен-контроллер
gw	10.0.2.1
ns	10.0.2.2
fs	10.0.2.3
www	CNAME	fs
boss	10.0.2.4
arm	10.0.2.5
mfu	10.0.2.6
cluster	10.0.2.10
node1	10.0.2.11
node2	10.0.2.12
dc	10.0.2.22
